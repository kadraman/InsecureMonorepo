version: '3.8'

services:
  users-service:
    build:
      context: ./services/users-service
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
    networks:
      - insecure-network
    # Vulnerability: No resource limits
    # Vulnerability: Running as root

  products-service:
    build:
      context: ./services/products-service
      dockerfile: Dockerfile
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - PORT=3002
    networks:
      - insecure-network
    # Vulnerability: No health checks

  orders-service:
    build:
      context: ./services/orders-service
      dockerfile: Dockerfile
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
      - PORT=3003
    networks:
      - insecure-network
    # Vulnerability: No restart policy

  api-gateway:
    build:
      context: ./services/api-gateway
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - PORT=3000
      - USERS_SERVICE_URL=http://users-service:3001
      - PRODUCTS_SERVICE_URL=http://products-service:3002
      - ORDERS_SERVICE_URL=http://orders-service:3003
    depends_on:
      - users-service
      - products-service
      - orders-service
    networks:
      - insecure-network
    # Vulnerability: No secrets management

networks:
  insecure-network:
    driver: bridge
    # Vulnerability: No network encryption
